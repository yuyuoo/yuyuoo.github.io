{"title":"利用NS3部署不同拓扑无线网络","date":"2020-11-13T08:48:59.000Z","date_formatted":{"ll":"Nov 13, 2020","L":"11/13/2020","MM-DD":"11-13"},"thumbnail":"https://i.loli.net/2020/11/13/xFtCvg2yAOqINRz.jpg","link":"2020/11/13/利用NS3部署不同拓扑无线网络","comments":true,"tags":["ns3"],"categories":["Programming"],"updated":"2020-11-26T08:56:10.833Z","content":"<p>在开始之前，首先在ubuntu16.04上安装好了ns3，过程来源于网上的教程。然后将examples/tutorial文件夹下的示例代码逐一学习了一遍。</p>\n<p>这里粘贴一下前三个程序的代码及注释：</p>\n<p>first.cc模拟了两个节点，一个server和一个client：</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* -*- Mode:C++; c-file-style:\"gnu\"; indent-tabs-mode:nil; -*- */</span></span><br><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\"> * This program is free software; you can redistribute it and/or modify</span></span><br><span class=\"line\"><span class=\"comment\"> * it under the terms of the GNU General Public License version 2 as</span></span><br><span class=\"line\"><span class=\"comment\"> * published by the Free Software Foundation;</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * This program is distributed in the hope that it will be useful,</span></span><br><span class=\"line\"><span class=\"comment\"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span></span><br><span class=\"line\"><span class=\"comment\"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span></span><br><span class=\"line\"><span class=\"comment\"> * GNU General Public License for more details.</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * You should have received a copy of the GNU General Public License</span></span><br><span class=\"line\"><span class=\"comment\"> * along with this program; if not, write to the Free Software</span></span><br><span class=\"line\"><span class=\"comment\"> * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">\"ns3/core-module.h\"</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">\"ns3/network-module.h\"</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">\"ns3/internet-module.h\"</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">\"ns3/point-to-point-module.h\"</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">\"ns3/applications-module.h\"</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> ns3;</span><br><span class=\"line\"></span><br><span class=\"line\">NS_LOG_COMPONENT_DEFINE (<span class=\"string\">\"FirstScriptExample\"</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">int</span></span><br><span class=\"line\">main (<span class=\"keyword\">int</span> argc, <span class=\"keyword\">char</span> *argv[])</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  CommandLine cmd;</span><br><span class=\"line\">  cmd.Parse (argc, argv);</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"comment\">//确定时间精度</span></span><br><span class=\"line\">  Time::SetResolution (Time::NS);</span><br><span class=\"line\">  <span class=\"comment\">//打开日志功能</span></span><br><span class=\"line\">  LogComponentEnable (<span class=\"string\">\"UdpEchoClientApplication\"</span>, LOG_LEVEL_INFO);</span><br><span class=\"line\">  LogComponentEnable (<span class=\"string\">\"UdpEchoServerApplication\"</span>, LOG_LEVEL_INFO);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">//先声明一个节点容器，然后创建两个节点。</span></span><br><span class=\"line\">  <span class=\"comment\">//这种节点是空节点，需要通过下面的配置加入网卡设备、协议栈等功能，实现数据传输</span></span><br><span class=\"line\">  NodeContainer nodes;</span><br><span class=\"line\">  nodes.Create (<span class=\"number\">2</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">//创建一条点到点线路，PointToPointHelper类 可以很方便的配置链路属性</span></span><br><span class=\"line\">  PointToPointHelper pointToPoint;</span><br><span class=\"line\">  pointToPoint.SetDeviceAttribute (<span class=\"string\">\"DataRate\"</span>, StringValue (<span class=\"string\">\"5Mbps\"</span>));</span><br><span class=\"line\">  pointToPoint.SetChannelAttribute (<span class=\"string\">\"Delay\"</span>, StringValue (<span class=\"string\">\"2ms\"</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">//给节点加载网卡设备并接入网络</span></span><br><span class=\"line\">  NetDeviceContainer devices;</span><br><span class=\"line\">  devices = pointToPoint.Install (nodes);</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"comment\">//给节点加载协议栈</span></span><br><span class=\"line\">  InternetStackHelper <span class=\"built_in\">stack</span>;</span><br><span class=\"line\">  <span class=\"built_in\">stack</span>.Install (nodes);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">//配置ipv4地址域</span></span><br><span class=\"line\">  Ipv4AddressHelper address;</span><br><span class=\"line\">  address.SetBase (<span class=\"string\">\"10.1.1.0\"</span>, <span class=\"string\">\"255.255.255.0\"</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">//将ipv4接口加载到网卡上</span></span><br><span class=\"line\">  Ipv4InterfaceContainer interfaces = address.Assign (devices);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">//给节点加载应用程序</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">//配置应用程序服务器端，并配置端口号9</span></span><br><span class=\"line\">  <span class=\"function\">UdpEchoServerHelper <span class=\"title\">echoServer</span> <span class=\"params\">(<span class=\"number\">9</span>)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">//将该服务器功能加载到指定节点，并配置服务器开始和结束时间</span></span><br><span class=\"line\">  ApplicationContainer serverApps = echoServer.Install (nodes.Get (<span class=\"number\">1</span>));</span><br><span class=\"line\">  serverApps.Start (Seconds (<span class=\"number\">1.0</span>));</span><br><span class=\"line\">  serverApps.Stop (Seconds (<span class=\"number\">10.0</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">//配置应用程序客户端，interfaces.GetAddress(1)获取服务器节点的ip地址，以及服务器端口号9</span></span><br><span class=\"line\">  <span class=\"function\">UdpEchoClientHelper <span class=\"title\">echoClient</span> <span class=\"params\">(interfaces.GetAddress (<span class=\"number\">1</span>), <span class=\"number\">9</span>)</span></span>;</span><br><span class=\"line\">  <span class=\"comment\">//此外还需配置客户端属性，例如包的大小和长度以及发包间隔</span></span><br><span class=\"line\">  echoClient.SetAttribute (<span class=\"string\">\"MaxPackets\"</span>, UintegerValue (<span class=\"number\">1</span>));</span><br><span class=\"line\">  echoClient.SetAttribute (<span class=\"string\">\"Interval\"</span>, TimeValue (Seconds (<span class=\"number\">1.0</span>)));</span><br><span class=\"line\">  echoClient.SetAttribute (<span class=\"string\">\"PacketSize\"</span>, UintegerValue (<span class=\"number\">1024</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">//将客户端功能加载到另一个节点上，同样需要配置客户端开始和结束时间</span></span><br><span class=\"line\">  ApplicationContainer clientApps = echoClient.Install (nodes.Get (<span class=\"number\">0</span>));</span><br><span class=\"line\">  clientApps.Start (Seconds (<span class=\"number\">2.0</span>));</span><br><span class=\"line\">  clientApps.Stop (Seconds (<span class=\"number\">10.0</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">//开启仿真器运行</span></span><br><span class=\"line\">  Simulator::Run ();</span><br><span class=\"line\">  Simulator::Destroy ();</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>second.cc模拟了一个n0和一个局域网，局域网与n0间p2p通信</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* -*- Mode:C++; c-file-style:\"gnu\"; indent-tabs-mode:nil; -*- */</span> <span class=\"comment\">//Emacs模式行，GPL boilerplate</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">\"ns3/core-module.h\"</span>       <span class=\"comment\">//</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">\"ns3/simulator-module.h\"</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">\"ns3/node-module.h\"</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">\"ns3/helper-module.h\"</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Default Network Topology</span></span><br><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"comment\">//       10.1.1.0</span></span><br><span class=\"line\"><span class=\"comment\">// n0 -------------- n1   n2   n3   n4</span></span><br><span class=\"line\"><span class=\"comment\">//    point-to-point  |    |    |    |</span></span><br><span class=\"line\"><span class=\"comment\">//                    ================</span></span><br><span class=\"line\"><span class=\"comment\">//                      LAN 10.1.2.0</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> ns3;</span><br><span class=\"line\"></span><br><span class=\"line\">NS_LOG_COMPONENT_DEFINE (<span class=\"string\">\"SecondScriptExample\"</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">int</span></span><br><span class=\"line\">main (<span class=\"keyword\">int</span> argc, <span class=\"keyword\">char</span> *argv[])</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"keyword\">bool</span> verbose = <span class=\"literal\">true</span>;  <span class=\"comment\">//定义变量，用于决定是否开启两个UdpApplication的Logging组件;默认true开启</span></span><br><span class=\"line\">    <span class=\"keyword\">uint32_t</span> nCsma = <span class=\"number\">3</span>;   <span class=\"comment\">//LAN中另有3个node</span></span><br><span class=\"line\"></span><br><span class=\"line\">    CommandLine cmd;</span><br><span class=\"line\">    cmd.AddValue (<span class=\"string\">\"nCsma\"</span>, <span class=\"string\">\"Number of \\\"extra\\\" CSMA nodes/devices\"</span>, nCsma);</span><br><span class=\"line\">    cmd.AddValue (<span class=\"string\">\"verbose\"</span>, <span class=\"string\">\"Tell echo applications to log if true\"</span>, verbose); <span class=\"comment\">//命令行参数设置是否开启logging</span></span><br><span class=\"line\"></span><br><span class=\"line\">    cmd.Parse (argc,argv);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (verbose)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        LogComponentEnable(<span class=\"string\">\"UdpEchoClientApplication\"</span>, LOG_LEVEL_INFO);</span><br><span class=\"line\">        LogComponentEnable(<span class=\"string\">\"UdpEchoServerApplication\"</span>, LOG_LEVEL_INFO);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    nCsma = nCsma == <span class=\"number\">0</span> ? <span class=\"number\">1</span> : nCsma;       <span class=\"comment\">//三目运算符还可以这样写。。。。</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/********************网络拓扑部分************************/</span></span><br><span class=\"line\">    <span class=\"comment\">//创建使用P2P链路链接的2个node</span></span><br><span class=\"line\">    NodeContainer p2pNodes;</span><br><span class=\"line\">    p2pNodes.Create (<span class=\"number\">2</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//创建另一个NodeContainer类对象，用于总线(CSMA)网络</span></span><br><span class=\"line\">    NodeContainer csmaNodes;</span><br><span class=\"line\">    csmaNodes.Add (p2pNodes.Get (<span class=\"number\">1</span>)); <span class=\"comment\">//将之前P2P的NodeContianer的第二个节点(索引1)添加到CSMA的NodeContainer，以获得CSMA device;这个node将会有两个device</span></span><br><span class=\"line\">    csmaNodes.Create (nCsma);         <span class=\"comment\">//再创建Bus network上另外的node</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//设置传送速率和信道延迟，同first.cc</span></span><br><span class=\"line\">    PointToPointHelper pointToPoint;       <span class=\"comment\">//注意使用Helper的固定格式：</span></span><br><span class=\"line\">    <span class=\"comment\">//1/helper对象声明及属性设置;</span></span><br><span class=\"line\">    <span class=\"comment\">//2/devices对象声明及接收helper对象安装方法的返回列表，安装方法的参数为节点对象！</span></span><br><span class=\"line\">    pointToPoint.SetDeviceAttribute (<span class=\"string\">\"DataRate\"</span>, StringValue (<span class=\"string\">\"5Mbps\"</span>));</span><br><span class=\"line\">    pointToPoint.SetChannelAttribute (<span class=\"string\">\"Delay\"</span>, StringValue (<span class=\"string\">\"2ms\"</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//安装P2P网卡设备到P2P网络节点，同first.cc</span></span><br><span class=\"line\">    NetDeviceContainer p2pDevices;</span><br><span class=\"line\">    p2pDevices = pointToPoint.Install (p2pNodes);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//类似于P2PHelper，CsmaHelper帮助创建和连接CSMA设备及信道</span></span><br><span class=\"line\">    CsmaHelper csma;</span><br><span class=\"line\">    csma.SetChannelAttribute (<span class=\"string\">\"DataRate\"</span>, StringValue (<span class=\"string\">\"100Mbps\"</span>));   <span class=\"comment\">//数据率由channel属性指定，而非Device属性;</span></span><br><span class=\"line\">    <span class=\"comment\">//因为CSMA不允许同一信道上有多个不同数据率的设备！</span></span><br><span class=\"line\">    csma.SetChannelAttribute (<span class=\"string\">\"Delay\"</span>, TimeValue (NanoSeconds (<span class=\"number\">6560</span>))); <span class=\"comment\">//speed-of-light delay???</span></span><br><span class=\"line\"></span><br><span class=\"line\">    NetDeviceContainer csmaDevices;</span><br><span class=\"line\">    csmaDevices = csma.Install (csmaNodes);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//安装网络协议</span></span><br><span class=\"line\">    InternetStackHelper <span class=\"built_in\">stack</span>;</span><br><span class=\"line\">    <span class=\"built_in\">stack</span>.Install (p2pNodes.Get (<span class=\"number\">0</span>));     <span class=\"comment\">//P2P链路中的第一个节点</span></span><br><span class=\"line\">    <span class=\"built_in\">stack</span>.Install (csmaNodes);            <span class=\"comment\">//P2P链路中的第二个节点包含在csmaNodes中</span></span><br><span class=\"line\"></span><br><span class=\"line\">    Ipv4AddressHelper address;                     <span class=\"comment\">//两个网段的IP地址类对象</span></span><br><span class=\"line\">    address.SetBase (<span class=\"string\">\"10.1.1.0\"</span>, <span class=\"string\">\"255.255.255.0\"</span>); <span class=\"comment\">//安排P2P网段的地址</span></span><br><span class=\"line\">    Ipv4InterfaceContainer p2pInterfaces;</span><br><span class=\"line\">    p2pInterfaces = address.Assign (p2pDevices);</span><br><span class=\"line\"></span><br><span class=\"line\">    address.SetBase (<span class=\"string\">\"10.1.2.0\"</span>, <span class=\"string\">\"255.255.255.0\"</span>); <span class=\"comment\">//安排CSMA网段地址</span></span><br><span class=\"line\">    Ipv4InterfaceContainer csmaInterfaces;</span><br><span class=\"line\">    csmaInterfaces = address.Assign (csmaDevices);</span><br><span class=\"line\">    <span class=\"comment\">/********************网络拓扑部分结束*********************/</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**********************应用程序部分*********************/</span></span><br><span class=\"line\">    <span class=\"function\">UdpEchoServerHelper <span class=\"title\">echoServer</span> <span class=\"params\">(<span class=\"number\">9</span>)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    ApplicationContainer serverApps = echoServer.Install (csmaNodes.Get (nCsma)); <span class=\"comment\">//将Server服务安装在CSMA网段的最后一个节点上，nCsma是可变的，所以不能用3</span></span><br><span class=\"line\">    serverApps.Start (Seconds (<span class=\"number\">1.0</span>));</span><br><span class=\"line\">    serverApps.Stop (Seconds (<span class=\"number\">10.0</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\">UdpEchoClientHelper <span class=\"title\">echoClient</span> <span class=\"params\">(csmaInterfaces.GetAddress (nCsma), <span class=\"number\">9</span>)</span></span>;        <span class=\"comment\">//同first.cc</span></span><br><span class=\"line\">    echoClient.SetAttribute (<span class=\"string\">\"MaxPackets\"</span>, UintegerValue (<span class=\"number\">1</span>));</span><br><span class=\"line\">    echoClient.SetAttribute (<span class=\"string\">\"Interval\"</span>, TimeValue (Seconds (<span class=\"number\">1.</span>)));</span><br><span class=\"line\">    echoClient.SetAttribute (<span class=\"string\">\"PacketSize\"</span>, UintegerValue (<span class=\"number\">1024</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">    ApplicationContainer clientApps = echoClient.Install (p2pNodes.Get (<span class=\"number\">0</span>));      <span class=\"comment\">//同first.cc</span></span><br><span class=\"line\">    clientApps.Start (Seconds (<span class=\"number\">2.0</span>));</span><br><span class=\"line\">    clientApps.Stop (Seconds (<span class=\"number\">10.0</span>));</span><br><span class=\"line\">    <span class=\"comment\">/**********************应用程序部分结束*********************/</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/****************调用全局路由Helper帮助建立网络路由*******************/</span></span><br><span class=\"line\">    Ipv4GlobalRoutingHelper::PopulateRoutingTables (); <span class=\"comment\">//全局路由管理器根据节点产生的链路通告为每个节点建立路由表</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/****************开启pcap跟踪*******************/</span></span><br><span class=\"line\">    <span class=\"comment\">//pointToPoint.EnablePcapAll (\"second\");        //开启P2PHelper类对象的pcap;\"second\"为保存文件的前缀名，两句的名称相同了？？？</span></span><br><span class=\"line\">    <span class=\"comment\">//前缀后的节点号是&lt;!全局节点号!&gt;，不用担心名称相同！</span></span><br><span class=\"line\">    <span class=\"comment\">//csma.EnablePcap (\"second\", csmaDevices.Get (1), true); //开启csmaHelper类对象的pcap</span></span><br><span class=\"line\">    <span class=\"comment\">//使用csma网段索引为1的设备(第二个)进行sniff，True开启Promiscuous mode</span></span><br><span class=\"line\">    <span class=\"comment\">//NodeContainer类对象的Get方法用于获得容器中给定索引下的节点，返回指向请求节点的指针！</span></span><br><span class=\"line\">    <span class=\"comment\">//Node类对象的GetId返回节点的全局ID(即节点列表中的索引号)？？？？？？？</span></span><br><span class=\"line\">    <span class=\"comment\">//注意之前使用的Get是NetDevice类的方法，以下使用的是Node类的方法！！</span></span><br><span class=\"line\">    <span class=\"comment\">//NetDevice不用取得ID，可以直接使用(已验证);但Node需要进一步查找ID!!（已验证，不使用GetId无法通过）</span></span><br><span class=\"line\">    <span class=\"comment\">//所以后边的两句和这样的两句是等效的(已验证)</span></span><br><span class=\"line\">    <span class=\"comment\">//  “csma.EnablePcap (\"second\", csmaDevices.Get (nCsma), 0);”</span></span><br><span class=\"line\">    <span class=\"comment\">//  “csma.EnablePcap (\"second\", csmaDevices.Get (nCsma-1), 0);”</span></span><br><span class=\"line\">    pointToPoint.EnablePcap (<span class=\"string\">\"second\"</span>, p2pNodes.Get (<span class=\"number\">0</span>)-&gt;GetId (), <span class=\"number\">0</span>);</span><br><span class=\"line\">    <span class=\"comment\">//最后一项为explicitFilename，默认false，不加也可;若true，将prefix作为文件名</span></span><br><span class=\"line\">    <span class=\"comment\">//倒数第二项promiscuous，默认false，此处仅想跟踪一个设备，故设为0(false);当有一个节点和设备的promiscuous模式设为true时，CSMA网段其它节点便不再产生trace文件。</span></span><br><span class=\"line\">    csma.EnablePcap (<span class=\"string\">\"second\"</span>, csmaNodes.Get (nCsma)-&gt;GetId (), <span class=\"number\">0</span>, <span class=\"literal\">false</span>);</span><br><span class=\"line\">    csma.EnablePcap (<span class=\"string\">\"second\"</span>, csmaNodes.Get (nCsma<span class=\"number\">-1</span>)-&gt;GetId (), <span class=\"number\">0</span>, <span class=\"literal\">false</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    Simulator::Run ();</span><br><span class=\"line\">    Simulator::Destroy ();</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>third.cc</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Default Network Topology </span></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"comment\">//   Wifi 10.1.3.0 </span></span><br><span class=\"line\"><span class=\"comment\">//                 AP </span></span><br><span class=\"line\"><span class=\"comment\">//  *    *    *    * </span></span><br><span class=\"line\"><span class=\"comment\">//  |    |    |    |    10.1.1.0 </span></span><br><span class=\"line\"><span class=\"comment\">// n5   n6   n7   n0 -------------- n1   n2   n3   n4 </span></span><br><span class=\"line\"><span class=\"comment\">//                   point-to-point  |    |    |    | </span></span><br><span class=\"line\"><span class=\"comment\">//                                   ================ </span></span><br><span class=\"line\"><span class=\"comment\">//                                     LAN 10.1.2.0   </span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">\"ns3/core-module.h\"</span> </span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">\"ns3/point-to-point-module.h\"</span> </span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">\"ns3/network-module.h\"</span> </span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">\"ns3/applications-module.h\"</span> </span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">\"ns3/wifi-module.h\"</span> </span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">\"ns3/mobility-module.h\"</span> </span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">\"ns3/csma-module.h\"</span> </span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">\"ns3/internet-module.h\"</span>  </span></span><br><span class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> ns3; </span><br><span class=\"line\"><span class=\"comment\">// 声明了一个叫 ThirdScriptExample 的日志构件，可以实现打开或者关闭控制台日志的输出。 </span></span><br><span class=\"line\">NS_LOG_COMPONENT_DEFINE (<span class=\"string\">\"ThirdScriptExample\"</span>);</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span> <span class=\"params\">(<span class=\"keyword\">int</span> argc, <span class=\"keyword\">char</span> *argv[])</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 定义变量，用于决定是否开启两个 UdpApplication 的 Logging 组件；默认 true 开启</span></span><br><span class=\"line\">    <span class=\"keyword\">bool</span> verbose = <span class=\"literal\">true</span>;</span><br><span class=\"line\">    <span class=\"keyword\">uint32_t</span> nCsma = <span class=\"number\">3</span>;</span><br><span class=\"line\">    <span class=\"keyword\">uint32_t</span> nWifi = <span class=\"number\">3</span>;</span><br><span class=\"line\">    <span class=\"keyword\">bool</span> tracing = <span class=\"literal\">false</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    CommandLine cmd;   </span><br><span class=\"line\">    cmd.AddValue (<span class=\"string\">\"nCsma\"</span>, <span class=\"string\">\"Number of \\\"extra\\\" CSMA nodes/devices\"</span>, nCsma);</span><br><span class=\"line\">    cmd.AddValue (<span class=\"string\">\"nWifi\"</span>, <span class=\"string\">\"Number of wifi STA devices\"</span>, nWifi);</span><br><span class=\"line\">    cmd.AddValue (<span class=\"string\">\"verbose\"</span>, <span class=\"string\">\"Tell echo applications to log if true\"</span>, verbose);</span><br><span class=\"line\">    cmd.AddValue (<span class=\"string\">\"tracing\"</span>, <span class=\"string\">\"Enable pcap tracing\"</span>, tracing);</span><br><span class=\"line\"></span><br><span class=\"line\">    cmd.Parse (argc,argv);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (nWifi &gt; <span class=\"number\">18</span>)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"built_in\">std</span>::<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"Number of wifi nodes \"</span> &lt;&lt; nWifi &lt;&lt;</span><br><span class=\"line\">        <span class=\"string\">\" specified exceeds the mobility bounding box\"</span> &lt;&lt; <span class=\"built_in\">std</span>::<span class=\"built_in\">endl</span>;</span><br><span class=\"line\">        <span class=\"built_in\">exit</span> (<span class=\"number\">1</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (verbose)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        LogComponentEnable (<span class=\"string\">\"UdpEchoClientApplication\"</span>, LOG_LEVEL_INFO);</span><br><span class=\"line\">        LogComponentEnable (<span class=\"string\">\"UdpEchoServerApplication\"</span>, LOG_LEVEL_INFO);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">/******************** 网络拓扑部分 ************************/</span></span><br><span class=\"line\">    <span class=\"comment\">// 创建使用 P2P 链路链接的 2 个节点</span></span><br><span class=\"line\">    NodeContainer p2pNodes;</span><br><span class=\"line\">    p2pNodes.Create (<span class=\"number\">2</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 设置传送速率和信道延迟</span></span><br><span class=\"line\">    PointToPointHelper pointToPoint;</span><br><span class=\"line\">    pointToPoint.SetDeviceAttribute (<span class=\"string\">\"DataRate\"</span>, StringValue (<span class=\"string\">\"5Mbps\"</span>));</span><br><span class=\"line\">    pointToPoint.SetChannelAttribute (<span class=\"string\">\"Delay\"</span>, StringValue (<span class=\"string\">\"2ms\"</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 安装 P2P 网卡设备到 P2P 网络节点</span></span><br><span class=\"line\">    NetDeviceContainer p2pDevices;</span><br><span class=\"line\">    p2pDevices = pointToPoint.Install (p2pNodes);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 创建 NodeContainer 类对象，用于总线 (CSMA) 网络</span></span><br><span class=\"line\">    NodeContainer csmaNodes;</span><br><span class=\"line\">    <span class=\"comment\">// 将第二个 P2P 节点添加到 CSMA 的 NodeContainer</span></span><br><span class=\"line\">    csmaNodes.Add (p2pNodes.Get (<span class=\"number\">1</span>));</span><br><span class=\"line\">    <span class=\"comment\">// 创建 Bus network 上另外 3 个 node</span></span><br><span class=\"line\">    csmaNodes.Create (nCsma);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 创建和连接 CSMA 设备及信道</span></span><br><span class=\"line\">    CsmaHelper csma;</span><br><span class=\"line\">    csma.SetChannelAttribute (<span class=\"string\">\"DataRate\"</span>, StringValue (<span class=\"string\">\"100Mbps\"</span>));</span><br><span class=\"line\">    csma.SetChannelAttribute (<span class=\"string\">\"Delay\"</span>, TimeValue (NanoSeconds (<span class=\"number\">6560</span>)));</span><br><span class=\"line\">        </span><br><span class=\"line\">    <span class=\"comment\">// 安装网卡设备到 CSMA 信道的网络节点</span></span><br><span class=\"line\">    NetDeviceContainer csmaDevices;</span><br><span class=\"line\">    csmaDevices = csma.Install (csmaNodes);</span><br><span class=\"line\">        </span><br><span class=\"line\">    <span class=\"comment\">// 创建 NodeContainer 类对象，用于 WiFi 网络</span></span><br><span class=\"line\">    NodeContainer wifiStaNodes;</span><br><span class=\"line\">    wifiStaNodes.Create (nWifi);</span><br><span class=\"line\">        </span><br><span class=\"line\">    <span class=\"comment\">// 设置 WiFi 网络的第一个节点为 AP</span></span><br><span class=\"line\">    NodeContainer wifiApNode = p2pNodes.Get (<span class=\"number\">0</span>);</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">// 初始化物理信道</span></span><br><span class=\"line\">    YansWifiChannelHelper channel = YansWifiChannelHelper::Default ();</span><br><span class=\"line\">    YansWifiPhyHelper phy = YansWifiPhyHelper::Default ();</span><br><span class=\"line\">    phy.SetChannel (channel.Create ());</span><br><span class=\"line\"></span><br><span class=\"line\">    WifiHelper wifi;</span><br><span class=\"line\">    wifi.SetRemoteStationManager (<span class=\"string\">\"ns3::AarfWifiManager\"</span>);</span><br><span class=\"line\">        </span><br><span class=\"line\">    <span class=\"comment\">//Mac 层设置</span></span><br><span class=\"line\">    NqosWifiMacHelper mac;</span><br><span class=\"line\">    Ssid ssid = Ssid (<span class=\"string\">\"ns-3-ssid\"</span>);</span><br><span class=\"line\">    mac.SetType (<span class=\"string\">\"ns3::StaWifiMac\"</span>,                </span><br><span class=\"line\">                <span class=\"string\">\"Ssid\"</span>, SsidValue (ssid),                </span><br><span class=\"line\">                <span class=\"string\">\"ActiveProbing\"</span>, BooleanValue (<span class=\"literal\">false</span>));</span><br><span class=\"line\">        </span><br><span class=\"line\">    <span class=\"comment\">// 安装网卡设备到 WiFi 信道的网络节点，并配置参数</span></span><br><span class=\"line\">    NetDeviceContainer staDevices;</span><br><span class=\"line\">    staDevices = wifi.Install (phy, mac, wifiStaNodes);</span><br><span class=\"line\"></span><br><span class=\"line\">    mac.SetType (<span class=\"string\">\"ns3::ApWifiMac\"</span>,                </span><br><span class=\"line\">                <span class=\"string\">\"Ssid\"</span>, SsidValue (ssid));</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//安装网卡设备到 WiFi 信道的 AP 节点，并配置参数</span></span><br><span class=\"line\">    NetDeviceContainer apDevices;</span><br><span class=\"line\">    apDevices = wifi.Install (phy, mac, wifiApNode);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 添加移动模型</span></span><br><span class=\"line\">    MobilityHelper mobility;</span><br><span class=\"line\"></span><br><span class=\"line\">    mobility.SetPositionAllocator (<span class=\"string\">\"ns3::GridPositionAllocator\"</span>,</span><br><span class=\"line\">                                    <span class=\"string\">\"MinX\"</span>, DoubleValue (<span class=\"number\">0.0</span>),                                  </span><br><span class=\"line\">                                    <span class=\"string\">\"MinY\"</span>, DoubleValue (<span class=\"number\">0.0</span>),                                  </span><br><span class=\"line\">                                    <span class=\"string\">\"DeltaX\"</span>, DoubleValue (<span class=\"number\">5.0</span>),                                  </span><br><span class=\"line\">                                    <span class=\"string\">\"DeltaY\"</span>, DoubleValue (<span class=\"number\">10.0</span>),                                  </span><br><span class=\"line\">                                    <span class=\"string\">\"GridWidth\"</span>, UintegerValue (<span class=\"number\">3</span>),                                  </span><br><span class=\"line\">                                    <span class=\"string\">\"LayoutType\"</span>, StringValue (<span class=\"string\">\"RowFirst\"</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">    mobility.SetMobilityModel (<span class=\"string\">\"ns3::RandomWalk2dMobilityModel\"</span>,                              </span><br><span class=\"line\">                                <span class=\"string\">\"Bounds\"</span>, RectangleValue (Rectangle (<span class=\"number\">-50</span>, <span class=\"number\">50</span>, <span class=\"number\">-50</span>, <span class=\"number\">50</span>)));</span><br><span class=\"line\">    <span class=\"comment\">// 在 STA 节点上安装移动模型</span></span><br><span class=\"line\">    mobility.Install (wifiStaNodes);</span><br><span class=\"line\">        </span><br><span class=\"line\">    <span class=\"comment\">// 设置 AP：固定在一个位置上</span></span><br><span class=\"line\">    mobility.SetMobilityModel (<span class=\"string\">\"ns3::ConstantPositionMobilityModel\"</span>);</span><br><span class=\"line\">    mobility.Install (wifiApNode);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 安装网络协议</span></span><br><span class=\"line\">    InternetStackHelper <span class=\"built_in\">stack</span>;</span><br><span class=\"line\">    <span class=\"built_in\">stack</span>.Install (csmaNodes);</span><br><span class=\"line\">    <span class=\"built_in\">stack</span>.Install (wifiApNode);</span><br><span class=\"line\">    <span class=\"built_in\">stack</span>.Install (wifiStaNodes);</span><br><span class=\"line\">    Ipv4AddressHelper address;</span><br><span class=\"line\">        </span><br><span class=\"line\">    <span class=\"comment\">// 安排 P2P 网段的地址</span></span><br><span class=\"line\">    address.SetBase (<span class=\"string\">\"10.1.1.0\"</span>, <span class=\"string\">\"255.255.255.0\"</span>);</span><br><span class=\"line\">    Ipv4InterfaceContainer p2pInterfaces;</span><br><span class=\"line\">    p2pInterfaces = address.Assign (p2pDevices);</span><br><span class=\"line\">    <span class=\"comment\">// 安排 csma 网段的地址</span></span><br><span class=\"line\">    address.SetBase (<span class=\"string\">\"10.1.2.0\"</span>, <span class=\"string\">\"255.255.255.0\"</span>);</span><br><span class=\"line\">    Ipv4InterfaceContainer csmaInterfaces;</span><br><span class=\"line\">    csmaInterfaces = address.Assign (csmaDevices);</span><br><span class=\"line\">        </span><br><span class=\"line\">    <span class=\"comment\">// 安排 wifi 网段的地址</span></span><br><span class=\"line\">    address.SetBase (<span class=\"string\">\"10.1.3.0\"</span>, <span class=\"string\">\"255.255.255.0\"</span>);</span><br><span class=\"line\">    address.Assign (staDevices);</span><br><span class=\"line\">    address.Assign (apDevices);</span><br><span class=\"line\">    <span class=\"comment\">/******************** 网络拓扑部分结束 *********************/</span></span><br><span class=\"line\">        </span><br><span class=\"line\">    <span class=\"comment\">/********************** 应用程序部分 *********************/</span></span><br><span class=\"line\">    <span class=\"function\">UdpEchoServerHelper <span class=\"title\">echoServer</span> <span class=\"params\">(<span class=\"number\">9</span>)</span></span>;</span><br><span class=\"line\">        </span><br><span class=\"line\">    <span class=\"comment\">// 将 Server 服务安装在 CSMA 网段的最后一个节点上</span></span><br><span class=\"line\">    ApplicationContainer serverApps = echoServer.Install (csmaNodes.Get (nCsma));</span><br><span class=\"line\">    serverApps.Start (Seconds (<span class=\"number\">1.0</span>));</span><br><span class=\"line\">    serverApps.Stop (Seconds (<span class=\"number\">10.0</span>));</span><br><span class=\"line\">        </span><br><span class=\"line\">    <span class=\"function\">UdpEchoClientHelper <span class=\"title\">echoClient</span> <span class=\"params\">(csmaInterfaces.GetAddress (nCsma), <span class=\"number\">9</span>)</span></span>;</span><br><span class=\"line\">    echoClient.SetAttribute (<span class=\"string\">\"MaxPackets\"</span>, UintegerValue (<span class=\"number\">1</span>));</span><br><span class=\"line\">    echoClient.SetAttribute (<span class=\"string\">\"Interval\"</span>, TimeValue (Seconds (<span class=\"number\">1.0</span>)));</span><br><span class=\"line\">    echoClient.SetAttribute (<span class=\"string\">\"PacketSize\"</span>, UintegerValue (<span class=\"number\">1024</span>));</span><br><span class=\"line\">        </span><br><span class=\"line\">    <span class=\"comment\">// 将 Client 应用安装在 WiFi 网段的倒数第二个节点上</span></span><br><span class=\"line\">    ApplicationContainer clientApps =echoClient.Install (wifiStaNodes.Get (nWifi - <span class=\"number\">1</span>));   </span><br><span class=\"line\">    clientApps.Start (Seconds (<span class=\"number\">2.0</span>));</span><br><span class=\"line\">    clientApps.Stop (Seconds (<span class=\"number\">10.0</span>));</span><br><span class=\"line\">        </span><br><span class=\"line\">    <span class=\"comment\">/**************** 调用全局路由 Helper 帮助建立网络路由 *******************/</span>   Ipv4GlobalRoutingHelper::PopulateRoutingTables ();</span><br><span class=\"line\">    Simulator::Stop (Seconds (<span class=\"number\">10.0</span>));</span><br><span class=\"line\">    <span class=\"comment\">/**************** 开启 pcap 跟踪 *******************/</span></span><br><span class=\"line\">    pointToPoint.EnablePcapAll (<span class=\"string\">\"third\"</span>);</span><br><span class=\"line\">    phy.EnablePcap (<span class=\"string\">\"third\"</span>, apDevices.Get (<span class=\"number\">0</span>));</span><br><span class=\"line\">    csma.EnablePcap (<span class=\"string\">\"third\"</span>, csmaDevices.Get (<span class=\"number\">0</span>), <span class=\"literal\">true</span>);</span><br><span class=\"line\">        </span><br><span class=\"line\">    Simulator::Run ();</span><br><span class=\"line\">    Simulator::Destroy ();</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"一、部署一个星型无线网络（一个ap，不少于5个接入点）\">一、部署一个星型无线网络（一个AP，不少于5个接入点）<a href=\"#一、部署一个星型无线网络（一个ap，不少于5个接入点）\" title=\"一、部署一个星型无线网络（一个AP，不少于5个接入点）\"></a></h2><p><strong>代码思路</strong>：</p>\n<p>默认建立一个AP结点和5个接入点，其中接入点的个数也可在运行时通过command传入，进行自定义。将AP的移动模型设置为静止状态，其他接入点可自由移动。</p>\n<p>具体流程：创建NodeContainer 类对象-&gt;初始化物理信道-&gt;Mac 层设置-&gt;安装网卡设备-&gt;添加移动模型-&gt;安装网络协议-&gt;安排网段的地址-&gt;安装Server 服务到指定节点-&gt;配置应用程序客户端并安装到指定节点-&gt;调用全局路由 Helper 帮助建立网络路由-&gt;开启仿真器运行。</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Default Network Topology </span></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"comment\">//   Wifi 10.1.3.0 </span></span><br><span class=\"line\"><span class=\"comment\">//                           AP </span></span><br><span class=\"line\"><span class=\"comment\">//  *    *    *    *    *    *</span></span><br><span class=\"line\"><span class=\"comment\">//  |    |    |    |    |    |</span></span><br><span class=\"line\"><span class=\"comment\">// n0   n4   n3   n2   n1   n5</span></span><br><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">\"ns3/core-module.h\"</span> </span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">\"ns3/network-module.h\"</span> </span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">\"ns3/applications-module.h\"</span> </span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">\"ns3/wifi-module.h\"</span> </span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">\"ns3/mobility-module.h\"</span> </span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">\"ns3/internet-module.h\"</span> </span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> ns3;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 声明了一个叫 StarWirelessNet 的日志构件，可以实现打开或者关闭控制台日志的输出。 </span></span><br><span class=\"line\">NS_LOG_COMPONENT_DEFINE (<span class=\"string\">\"StarWirelessNet\"</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span> <span class=\"params\">(<span class=\"keyword\">int</span> argc, <span class=\"keyword\">char</span> *argv[])</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 定义变量，用于决定是否开启两个 UdpApplication 的 Logging 组件；默认 true 开启</span></span><br><span class=\"line\">    <span class=\"keyword\">bool</span> verbose = <span class=\"literal\">true</span>;</span><br><span class=\"line\">    <span class=\"keyword\">uint32_t</span> nWifi = <span class=\"number\">5</span>;</span><br><span class=\"line\">    <span class=\"keyword\">bool</span> tracing = <span class=\"literal\">false</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    CommandLine cmd;</span><br><span class=\"line\">    cmd.AddValue (<span class=\"string\">\"nWifi\"</span>, <span class=\"string\">\"Number of wifi STA devices\"</span>, nWifi);</span><br><span class=\"line\">    cmd.AddValue (<span class=\"string\">\"verbose\"</span>, <span class=\"string\">\"Tell echo applications to log if true\"</span>, verbose);</span><br><span class=\"line\">    cmd.AddValue (<span class=\"string\">\"tracing\"</span>, <span class=\"string\">\"Enable pcap tracing\"</span>, tracing);</span><br><span class=\"line\"></span><br><span class=\"line\">    cmd.Parse (argc,argv);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (nWifi &gt; <span class=\"number\">18</span>)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"built_in\">std</span>::<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"Number of wifi nodes \"</span> &lt;&lt; nWifi &lt;&lt;</span><br><span class=\"line\">        <span class=\"string\">\" specified exceeds the mobility bounding box\"</span> &lt;&lt; <span class=\"built_in\">std</span>::<span class=\"built_in\">endl</span>;</span><br><span class=\"line\">        <span class=\"built_in\">exit</span> (<span class=\"number\">1</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (verbose)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        LogComponentEnable (<span class=\"string\">\"UdpEchoClientApplication\"</span>, LOG_LEVEL_INFO);</span><br><span class=\"line\">        LogComponentEnable (<span class=\"string\">\"UdpEchoServerApplication\"</span>, LOG_LEVEL_INFO);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 创建 NodeContainer 类对象，用于 WiFi 网络</span></span><br><span class=\"line\">    NodeContainer wifiStaNodes;</span><br><span class=\"line\">    wifiStaNodes.Create (nWifi);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 创建一个 WiFi 网络的AP</span></span><br><span class=\"line\">    NodeContainer wifiApNode;</span><br><span class=\"line\">    wifiApNode.Create (<span class=\"number\">1</span>);</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">// 初始化物理信道</span></span><br><span class=\"line\">    YansWifiChannelHelper channel = YansWifiChannelHelper::Default ();</span><br><span class=\"line\">    YansWifiPhyHelper phy = YansWifiPhyHelper::Default ();</span><br><span class=\"line\">    phy.SetChannel (channel.Create ());</span><br><span class=\"line\"></span><br><span class=\"line\">    WifiHelper wifi;</span><br><span class=\"line\">    wifi.SetRemoteStationManager (<span class=\"string\">\"ns3::AarfWifiManager\"</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//Mac 层设置,Service Set Identifier将一个无线局域网分为几个需要不同身份验证的子网络</span></span><br><span class=\"line\">    WifiMacHelper mac;</span><br><span class=\"line\">    Ssid ssid = Ssid (<span class=\"string\">\"ns-3-ssid\"</span>);</span><br><span class=\"line\">    mac.SetType (<span class=\"string\">\"ns3::StaWifiMac\"</span>,</span><br><span class=\"line\">               <span class=\"string\">\"Ssid\"</span>, SsidValue (ssid),</span><br><span class=\"line\">               <span class=\"string\">\"ActiveProbing\"</span>, BooleanValue (<span class=\"literal\">false</span>));</span><br><span class=\"line\">        </span><br><span class=\"line\">    <span class=\"comment\">// 安装网卡设备到 WiFi 信道的sta节点，并配置参数</span></span><br><span class=\"line\">    NetDeviceContainer staDevices;</span><br><span class=\"line\">    staDevices = wifi.Install (phy, mac, wifiStaNodes);</span><br><span class=\"line\"></span><br><span class=\"line\">    mac.SetType (<span class=\"string\">\"ns3::ApWifiMac\"</span>,</span><br><span class=\"line\">                <span class=\"string\">\"Ssid\"</span>, SsidValue (ssid));</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//安装网卡设备到 WiFi 信道的 AP 节点，并配置参数</span></span><br><span class=\"line\">    NetDeviceContainer apDevices;</span><br><span class=\"line\">    apDevices = wifi.Install (phy, mac, wifiApNode);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 添加移动模型</span></span><br><span class=\"line\">    MobilityHelper mobility;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//GridWidth:一行最多有几个节点</span></span><br><span class=\"line\">    <span class=\"comment\">//DeltaX:x轴上节点间的距离</span></span><br><span class=\"line\">    <span class=\"comment\">//DeltaY:y轴上节点间的距离</span></span><br><span class=\"line\">    mobility.SetPositionAllocator (<span class=\"string\">\"ns3::GridPositionAllocator\"</span>,</span><br><span class=\"line\">                                    <span class=\"string\">\"MinX\"</span>, DoubleValue (<span class=\"number\">0.0</span>),</span><br><span class=\"line\">                                    <span class=\"string\">\"MinY\"</span>, DoubleValue (<span class=\"number\">0.0</span>),</span><br><span class=\"line\">                                    <span class=\"string\">\"DeltaX\"</span>, DoubleValue (<span class=\"number\">10.0</span>),</span><br><span class=\"line\">                                    <span class=\"string\">\"DeltaY\"</span>, DoubleValue (<span class=\"number\">15.0</span>),</span><br><span class=\"line\">                                    <span class=\"string\">\"GridWidth\"</span>, UintegerValue (<span class=\"number\">3</span>),</span><br><span class=\"line\">                                    <span class=\"string\">\"LayoutType\"</span>, StringValue (<span class=\"string\">\"RowFirst\"</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//在一个2d场景随机运动，方向和速度都是随机的</span></span><br><span class=\"line\">    <span class=\"comment\">//Bounds:运动的范围</span></span><br><span class=\"line\">    mobility.SetMobilityModel (<span class=\"string\">\"ns3::RandomWalk2dMobilityModel\"</span>,</span><br><span class=\"line\">                                <span class=\"string\">\"Bounds\"</span>, RectangleValue (Rectangle (<span class=\"number\">-50</span>, <span class=\"number\">50</span>, <span class=\"number\">-50</span>, <span class=\"number\">50</span>)));</span><br><span class=\"line\">    <span class=\"comment\">// 在 STA 节点上安装移动模型</span></span><br><span class=\"line\">    mobility.Install (wifiStaNodes);</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">// 设置 AP：固定在一个位置上</span></span><br><span class=\"line\">    mobility.SetMobilityModel (<span class=\"string\">\"ns3::ConstantPositionMobilityModel\"</span>);</span><br><span class=\"line\">    mobility.Install (wifiApNode);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 安装网络协议</span></span><br><span class=\"line\">    InternetStackHelper <span class=\"built_in\">stack</span>;</span><br><span class=\"line\">    <span class=\"built_in\">stack</span>.Install (wifiApNode);</span><br><span class=\"line\">    <span class=\"built_in\">stack</span>.Install (wifiStaNodes);</span><br><span class=\"line\">    Ipv4AddressHelper address;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 安排 wifi 网段的地址</span></span><br><span class=\"line\">    address.SetBase (<span class=\"string\">\"10.1.1.0\"</span>, <span class=\"string\">\"255.255.255.0\"</span>);</span><br><span class=\"line\">    Ipv4InterfaceContainer wifiInterfaces;</span><br><span class=\"line\">    address.Assign (staDevices);</span><br><span class=\"line\">    wifiInterfaces = address.Assign (apDevices);</span><br><span class=\"line\">    <span class=\"comment\">/******************** 网络拓扑部分结束 *********************/</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/********************** 应用程序部分 *********************/</span></span><br><span class=\"line\">    <span class=\"function\">UdpEchoServerHelper <span class=\"title\">echoServer</span> <span class=\"params\">(<span class=\"number\">9</span>)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 将 Server 服务安装在 AP节点上</span></span><br><span class=\"line\">    ApplicationContainer serverApps = echoServer.Install (wifiApNode);</span><br><span class=\"line\">    serverApps.Start (Seconds (<span class=\"number\">1.0</span>));</span><br><span class=\"line\">    serverApps.Stop (Seconds (<span class=\"number\">10.0</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//配置应用程序客户端，wifiInterfaces.GetAddress (0)获取服务器节点的ip地址，以及服务器端口号9</span></span><br><span class=\"line\">    <span class=\"function\">UdpEchoClientHelper <span class=\"title\">echoClient</span> <span class=\"params\">(wifiInterfaces.GetAddress (<span class=\"number\">0</span>), <span class=\"number\">9</span>)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//此外还需配置客户端属性，例如包的大小和长度以及发包间隔</span></span><br><span class=\"line\">    echoClient.SetAttribute (<span class=\"string\">\"MaxPackets\"</span>, UintegerValue (<span class=\"number\">1</span>));</span><br><span class=\"line\">    echoClient.SetAttribute (<span class=\"string\">\"Interval\"</span>, TimeValue (Seconds (<span class=\"number\">1.0</span>)));</span><br><span class=\"line\">    echoClient.SetAttribute (<span class=\"string\">\"PacketSize\"</span>, UintegerValue (<span class=\"number\">1024</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//将客户端功能加载到一个sta节点上，同样需要配置客户端开始和结束时间</span></span><br><span class=\"line\">    ApplicationContainer clientApps = echoClient.Install (wifiStaNodes.Get (nWifi - <span class=\"number\">1</span>));</span><br><span class=\"line\">    clientApps.Start (Seconds (<span class=\"number\">2.0</span>));</span><br><span class=\"line\">    clientApps.Stop (Seconds (<span class=\"number\">10.0</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**************** 调用全局路由 Helper 帮助建立网络路由 *******************/</span></span><br><span class=\"line\">    Ipv4GlobalRoutingHelper::PopulateRoutingTables ();</span><br><span class=\"line\">    Simulator::Stop (Seconds (<span class=\"number\">10.0</span>));</span><br><span class=\"line\">    <span class=\"comment\">/**************** 开启 pcap 跟踪 *******************/</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (tracing == <span class=\"literal\">true</span>)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      phy.EnablePcap (<span class=\"string\">\"star\"</span>, apDevices.Get (<span class=\"number\">0</span>));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//开启仿真器运行</span></span><br><span class=\"line\">    Simulator::Run ();</span><br><span class=\"line\">    Simulator::Destroy ();</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>运行结果：</strong></p>\n<p><img src=\"https://s3.ax1x.com/2020/11/13/DpsveU.png\" class=\"φcy\" alt=\"1\"></p>\n<p><strong>图形界面：</strong></p>\n<p>要显示图形界面，在运行命令后面加<code>--vis</code></p>\n<p><img src=\"https://s3.ax1x.com/2020/11/13/DpyZwD.png\" class=\"φcy\" alt=\"2\"></p>\n<p><img src=\"https://s3.ax1x.com/2020/11/13/Dpyh11.png\" class=\"φcy\" alt=\"3\"></p>\n<h2 id=\"二、部署多跳无线网络（不少于6个网络节点）\">二、部署多跳无线网络（不少于6个网络节点）<a href=\"#二、部署多跳无线网络（不少于6个网络节点）\" title=\"二、部署多跳无线网络（不少于6个网络节点）\"></a></h2><p><strong>代码思路：</strong></p>\n<p>创建6个网络节点作为多跳无线网络的节点，使用on-off类控制发给node0的9999端口，并一直处于发送状态，安装到node5上；安装packetSink类到node0，用来接收和消耗到9999端口的流量。</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* -*- Mode:C++; c-file-style:\"gnu\"; indent-tabs-mode:nil; -*- */</span></span><br><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\"> * This program is free software; you can redistribute it and/or modify</span></span><br><span class=\"line\"><span class=\"comment\"> * it under the terms of the GNU General Public License version 2 as</span></span><br><span class=\"line\"><span class=\"comment\"> * published by the Free Software Foundation;</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * This program is distributed in the hope that it will be useful,</span></span><br><span class=\"line\"><span class=\"comment\"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span></span><br><span class=\"line\"><span class=\"comment\"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span></span><br><span class=\"line\"><span class=\"comment\"> * GNU General Public License for more details.</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> * You should have received a copy of the GNU General Public License</span></span><br><span class=\"line\"><span class=\"comment\"> * along with this program; if not, write to the Free Software</span></span><br><span class=\"line\"><span class=\"comment\"> * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA */</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">\"ns3/core-module.h\"</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">\"ns3/network-module.h\"</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">\"ns3/applications-module.h\"</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">\"ns3/wifi-module.h\"</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">\"ns3/mobility-module.h\"</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">\"ns3/internet-module.h\"</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> ns3;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 声明了一个叫 AdHocExample 的日志构件，可以实现打开或者关闭控制台日志的输出。 </span></span><br><span class=\"line\">NS_LOG_COMPONENT_DEFINE (<span class=\"string\">\"AdHocExample\"</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">int</span></span><br><span class=\"line\">main(<span class=\"keyword\">int</span> argc,<span class=\"keyword\">char</span> *argv[])</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    Time::SetResolution (Time::NS);</span><br><span class=\"line\"></span><br><span class=\"line\">    LogComponentEnable (<span class=\"string\">\"AdHocExample\"</span>, LOG_LEVEL_INFO);</span><br><span class=\"line\">    <span class=\"comment\">// LogComponentEnable (\"TcpL4Protocol\", LOG_LEVEL_INFO);</span></span><br><span class=\"line\">    LogComponentEnable (<span class=\"string\">\"PacketSink\"</span>, LOG_LEVEL_ALL);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">uint32_t</span> nAdHoc=<span class=\"number\">6</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    CommandLine cmd;</span><br><span class=\"line\"></span><br><span class=\"line\">    cmd.AddValue (<span class=\"string\">\"nAdHoc\"</span>, <span class=\"string\">\"Number of wifi ad devices\"</span>, nAdHoc);</span><br><span class=\"line\">    </span><br><span class=\"line\">    cmd.Parse (argc,argv);</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">// 创建 NodeContainer 类对象</span></span><br><span class=\"line\">    NodeContainer AdHocNode;</span><br><span class=\"line\">    AdHocNode.Create(nAdHoc);</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">// 初始化物理信道</span></span><br><span class=\"line\">    YansWifiChannelHelper channel = YansWifiChannelHelper::Default ();</span><br><span class=\"line\">    YansWifiPhyHelper phy = YansWifiPhyHelper::Default ();</span><br><span class=\"line\">    phy.SetChannel (channel.Create ());</span><br><span class=\"line\">    </span><br><span class=\"line\">    WifiHelper wifi;</span><br><span class=\"line\">    wifi.SetStandard(WIFI_PHY_STANDARD_80211a); <span class=\"comment\">//设置标准</span></span><br><span class=\"line\">    wifi.SetRemoteStationManager(<span class=\"string\">\"ns3::ConstantRateWifiManager\"</span>,<span class=\"string\">\"DataMode\"</span>,StringValue(<span class=\"string\">\"OfdmRate6Mbps\"</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//Mac 层设置</span></span><br><span class=\"line\">    WifiMacHelper mac;</span><br><span class=\"line\">    mac.SetType (<span class=\"string\">\"ns3::AdhocWifiMac\"</span>,</span><br><span class=\"line\">                    <span class=\"string\">\"Slot\"</span>, StringValue (<span class=\"string\">\"16us\"</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 安装网卡设备</span></span><br><span class=\"line\">    NetDeviceContainer AdHocDevices;</span><br><span class=\"line\">    AdHocDevices = wifi.Install(phy,mac,AdHocNode);</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">// 添加移动模型</span></span><br><span class=\"line\">    MobilityHelper mobility;</span><br><span class=\"line\">    mobility.SetPositionAllocator (<span class=\"string\">\"ns3::GridPositionAllocator\"</span>,</span><br><span class=\"line\">                                        <span class=\"string\">\"MinX\"</span>, DoubleValue (<span class=\"number\">0.0</span>),</span><br><span class=\"line\">                                        <span class=\"string\">\"MinY\"</span>, DoubleValue (<span class=\"number\">0.0</span>),</span><br><span class=\"line\">                                        <span class=\"string\">\"DeltaX\"</span>, DoubleValue (<span class=\"number\">10.0</span>),</span><br><span class=\"line\">                                        <span class=\"string\">\"DeltaY\"</span>, DoubleValue (<span class=\"number\">15.0</span>),</span><br><span class=\"line\">                                        <span class=\"string\">\"GridWidth\"</span>, UintegerValue (<span class=\"number\">4</span>),</span><br><span class=\"line\">                                        <span class=\"string\">\"LayoutType\"</span>, StringValue (<span class=\"string\">\"RowFirst\"</span>));</span><br><span class=\"line\">    mobility.SetMobilityModel (<span class=\"string\">\"ns3::RandomWalk2dMobilityModel\"</span>,</span><br><span class=\"line\">                                <span class=\"string\">\"Bounds\"</span>, RectangleValue (Rectangle (<span class=\"number\">-50</span>, <span class=\"number\">50</span>, <span class=\"number\">-50</span>, <span class=\"number\">50</span>)));</span><br><span class=\"line\">    <span class=\"comment\">// 在 AdHoc 节点上安装移动模型</span></span><br><span class=\"line\">    mobility.Install (AdHocNode);</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">// 安装网络协议</span></span><br><span class=\"line\">    InternetStackHelper Internet;</span><br><span class=\"line\">    Internet.Install(AdHocNode);</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">// 安排网段的地址</span></span><br><span class=\"line\">    Ipv4AddressHelper address;</span><br><span class=\"line\">    address.SetBase(<span class=\"string\">\"195.1.1.0\"</span>,<span class=\"string\">\"255.255.255.0\"</span>);</span><br><span class=\"line\">    </span><br><span class=\"line\">    Ipv4InterfaceContainer AdHocIp;</span><br><span class=\"line\">    AdHocIp = address.Assign(AdHocDevices);</span><br><span class=\"line\">    <span class=\"comment\">/******************** 网络拓扑部分结束 *********************/</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">/********************** 应用程序部分 *********************/</span></span><br><span class=\"line\">    NS_LOG_INFO (<span class=\"string\">\"Create Applications.\"</span>);</span><br><span class=\"line\">    <span class=\"keyword\">uint16_t</span> port = <span class=\"number\">9999</span>;</span><br><span class=\"line\">    <span class=\"function\">OnOffHelper <span class=\"title\">onOff1</span><span class=\"params\">(<span class=\"string\">\"ns3::TcpSocketFactory\"</span>,Address(InetSocketAddress(AdHocIp.GetAddress(<span class=\"number\">0</span>),port)))</span></span>;</span><br><span class=\"line\">    <span class=\"comment\">//m_onTime和 m_offTime分别为发送持续的时间和不发送持续的时间</span></span><br><span class=\"line\">    <span class=\"comment\">//这里的写法表示一直处于发送状态</span></span><br><span class=\"line\">    onOff1.SetAttribute (<span class=\"string\">\"OnTime\"</span>, StringValue (<span class=\"string\">\"ns3::ConstantRandomVariable[Constant=1]\"</span>));</span><br><span class=\"line\">    onOff1.SetAttribute (<span class=\"string\">\"OffTime\"</span>, StringValue (<span class=\"string\">\"ns3::ConstantRandomVariable[Constant=0]\"</span>));</span><br><span class=\"line\">    </span><br><span class=\"line\">    ApplicationContainer apps1 = onOff1.Install(AdHocNode);</span><br><span class=\"line\">    apps1.Start(Seconds(<span class=\"number\">2.0</span>));</span><br><span class=\"line\">    apps1.Stop(Seconds(<span class=\"number\">10.0</span>));</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">//packetSink是一个对于on-off application的补充类，它可以接收和消耗到某一个地址和端口的流量</span></span><br><span class=\"line\">    <span class=\"comment\">//第一个参数选定用于创建套接字的factory类型，绑定接收端的IP地址和端口</span></span><br><span class=\"line\">    <span class=\"comment\">//Ipv4Address::GetAny ()返回主机的所有IP地址</span></span><br><span class=\"line\">    <span class=\"comment\">//将PacketSinkApplication安装到 node0</span></span><br><span class=\"line\">    <span class=\"function\">PacketSinkHelper <span class=\"title\">sinkHelper</span> <span class=\"params\">(<span class=\"string\">\"ns3::TcpSocketFactory\"</span>, Address(InetSocketAddress (Ipv4Address::GetAny(), port)))</span></span>;</span><br><span class=\"line\">    ApplicationContainer apps2 = sinkHelper.Install(AdHocNode.Get(<span class=\"number\">0</span>));</span><br><span class=\"line\">    </span><br><span class=\"line\">    apps2.Start(Seconds(<span class=\"number\">0.0</span>));</span><br><span class=\"line\">    apps2.Stop(Seconds(<span class=\"number\">10.0</span>));</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">/**************** 调用全局路由 Helper 帮助建立网络路由 *******************/</span></span><br><span class=\"line\">    Ipv4GlobalRoutingHelper::PopulateRoutingTables ();</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">//开启仿真器运行 </span></span><br><span class=\"line\">    Simulator::Stop(Seconds(<span class=\"number\">10.0</span>));</span><br><span class=\"line\">    Simulator::Run();</span><br><span class=\"line\">    Simulator::Destroy();</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>仿真结果：</strong></p>\n<p><img src=\"https://s3.ax1x.com/2020/11/13/Dp6I8s.png\" class=\"φcy\" alt=\"4\"></p>\n<p><img src=\"https://s3.ax1x.com/2020/11/13/DpciqK.png\" class=\"φcy\" alt=\"5\"></p>\n<h2 id=\"三、利用ns3部署一个lte网络\">三、利用NS3部署一个LTE网络<a href=\"#三、利用ns3部署一个lte网络\" title=\"三、利用NS3部署一个LTE网络\"></a></h2><p>LTE 网络的网络节点之间的接口和协议：</p>\n<p><img src=\"https://i.loli.net/2020/11/26/1yI8cLuOBgnGpYW.png\" class=\"φcy\" alt=\"6\"></p>\n<p>E-UTRAN 的系统结构：</p>\n<p><img src=\"https://i.loli.net/2020/11/26/hd6gsz8ypJoDaMY.png\" class=\"φcy\" alt=\"7\"></p>\n<p>eNB 简单说就是代表基站，是 UE (用户) 与核心网之间的桥梁；eNB 之间由 X2 接口互连，每个 eNB 又和演进型分组核心网 EPC 通过 S1 接口相连。S1 接口的用户面终止在服务网关 S-GW 上，S1 接口的控制面终止在移动性管理实体 MME 上。控制面和用户面的另一端终止在 eNB 上。</p>\n<p>EPC 网络架构:</p>\n<p>EPC 的网元主要包括 MME，SGW，PGW。因此相应的 EPC 协议也是围绕这三个网元之间的接口来展开的。他们之间的接口协议如图所示:</p>\n<p><img src=\"https://i.loli.net/2020/11/26/ekROgQWKs1lL6qd.jpg\" class=\"φcy\" alt=\"8\"></p>\n<p>MME（Mobility Management Entity)：是移动管理实体，是一个用于信令控制的网元，主要用作移动性的管理。</p>\n<p>S-GW (Serving Gateway)：核心网的服务网关，是数据面的网元，数据面可以理解为数据传输的处理通道，负责本地网络用户数据处理。</p>\n<p>P-GW (PDN Gateway)：PDN（Public Data Network）公共数据网，充当外部数据连接的边界。</p>\n<p>小区：一个基站覆盖的范围就叫小区，每个小区都有独立的小区号。</p>\n<p>扇区：通常一个基站分为三个扇区，每个扇区打向一个方向，每个扇区覆盖 120 度的范围。所朝向的那个扇区，有一个编号，叫 CI 号。同一个基站下的 CI 号的个位数是连续的，各位数一般是 1、2、3。</p>\n<p>【实验内容】：</p>\n<p>利用利用NS3部署一个LTE网络，具体参数如表所示</p>\n<p><img src=\"https://i.loli.net/2020/11/26/4YsnovMtZhiBNI3.png\" class=\"φcy\" alt=\"9\"></p>\n<p>绘制仿真的Radio Environment Map。</p>\n<p>【代码思路】：以lena-dual-stripe.cc为基础，本文主要介绍基于lena-dual-stripe.cc的参数修改</p>\n<p>1)   基站距离设置为500m</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">static</span> ns3::GlobalValue <span class=\"title\">g_interSiteDistance</span> <span class=\"params\">(<span class=\"string\">\"interSiteDistance\"</span>, <span class=\"string\">\"min distance between two nearby macro cell sites\"</span>, ns3::DoubleValue (<span class=\"number\">500</span>), ns3::MakeDoubleChecker&lt;<span class=\"keyword\">double</span>&gt; ())</span></span>;</span><br></pre></td></tr></table></figure>\n\n<p>2)   基站发射功率(46dBm)</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">static</span> ns3::GlobalValue <span class=\"title\">g_macroEnbTxPowerDbm</span> <span class=\"params\">(<span class=\"string\">\"macroEnbTxPowerDbm\"</span>, <span class=\"string\">\"TX power [dBm] used by macro eNBs\"</span>, ns3::DoubleValue (<span class=\"number\">46.0</span>), ns3::MakeDoubleChecker&lt;<span class=\"keyword\">double</span>&gt; ())</span></span>;</span><br></pre></td></tr></table></figure>\n\n<p>3)   天线波束宽度(70°)</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">lteHelper-&gt;SetEnbAntennaModelAttribute (<span class=\"string\">\"Beamwidth\"</span>,DoubleValue (<span class=\"number\">70</span>));</span><br></pre></td></tr></table></figure>\n\n<p>4)   天线最大衰减（25.0） </p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">lteHelper-&gt;SetEnbAntennaModelAttribute (<span class=\"string\">\"MaxAttenuation\"</span>, DoubleValue (<span class=\"number\">25.0</span>));</span><br></pre></td></tr></table></figure>\n\n<p>5)   系统带宽(20MHz)</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">static</span> ns3::GlobalValue <span class=\"title\">g_homeEnbBandwidth</span> <span class=\"params\">(<span class=\"string\">\"homeEnbBandwidth\"</span>,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\"><span class=\"string\">\"bandwidth [num RBs] used by HeNBs\"</span>,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">ns3::UintegerValue (<span class=\"number\">20</span>),                ns3::MakeUintegerChecker&lt;<span class=\"keyword\">uint16_t</span>&gt; ())</span></span>;</span><br></pre></td></tr></table></figure>\n\n<p>6)   路径损耗模型</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">lteHelper-&gt;SetAttribute (<span class=\"string\">\"\"</span>, StringValue (<span class=\"string\">\"ns3::HybridBuildingsPropagationLossModel\"</span>));</span><br></pre></td></tr></table></figure>\n\n<p>7)   用户设备高度(1.5)</p>\n<p>Z轴设置为1.5，设备高度即为1.5。</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">remHelper-&gt;SetAttribute (<span class=\"string\">\"XMin\"</span>, DoubleValue (macroUeBox.xMin)); remHelper-&gt;SetAttribute (<span class=\"string\">\"XMax\"</span>, DoubleValue (macroUeBox.xMax));</span><br><span class=\"line\">remHelper-&gt;SetAttribute (<span class=\"string\">\"YMin\"</span>, DoubleValue (macroUeBox.yMin));</span><br><span class=\"line\">remHelper-&gt;SetAttribute (<span class=\"string\">\"YMax\"</span>, DoubleValue (macroUeBox.yMax));</span><br><span class=\"line\">remHelper-&gt;SetAttribute (<span class=\"string\">\"Z\"</span>, DoubleValue (<span class=\"number\">1.5</span>));</span><br></pre></td></tr></table></figure>\n\n<p>【运行程序】：</p>\n<p>1)   命令语句</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">.&#x2F;waf --run&#x3D;&quot;lena-dual-stripe</span><br><span class=\"line\">--generateRem&#x3D;1 --nMacroEnbSites&#x3D;7 --nMacroEnbSitesX&#x3D;2 </span><br><span class=\"line\">--ns3::RadioBearerStatsCalculator::DlRlcOutputFilename&#x3D;a3-rsrp-DlRlcStats.txt</span><br><span class=\"line\">--ns3::RadioBearerStatsCalculator::UlRlcOutputFilename&#x3D;a3-rsrp-UlRlcStats.txt&quot;</span><br></pre></td></tr></table></figure>\n\n<p>其中nMacroEnbSites=7表示宏小区站点数量为7，nMacroEnbSitesX=2表示各站点以2-3-2的方式排列。</p>\n<p>2)   画图脚本</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">set</span> view map;</span><br><span class=\"line\"><span class=\"built_in\">set</span> xlabel <span class=\"string\">\"X\"</span></span><br><span class=\"line\"><span class=\"built_in\">set</span> ylabel <span class=\"string\">\"Y\"</span></span><br><span class=\"line\"><span class=\"built_in\">set</span> cblabel <span class=\"string\">\"SINR (dB)\"</span></span><br><span class=\"line\"><span class=\"built_in\">unset</span> key</span><br><span class=\"line\">plot <span class=\"string\">\"lena-dual-stripe.rem\"</span> using (<span class=\"variable\">$1</span>):(<span class=\"variable\">$2</span>):(10*log10(<span class=\"variable\">$4</span>)) with image</span><br></pre></td></tr></table></figure>\n\n<p>脚本命名为plot_script.</p>\n<p>3)   仿真图</p>\n<p>输入命令<code>gnuplot -p enbs.txt ues.txt buildings.txt plot_script</code>得到仿真的Radio Environment Map</p>\n<p><img src=\"https://s3.ax1x.com/2020/11/26/D0slTK.jpg\" class=\"φcy\" alt=\"10\"></p>\n","prev":{"title":"在NS2中添加一个新协议的步骤","link":"2020/12/16/在NS2中添加一个新协议的步骤"},"next":{"title":"算法笔记之《算法笔记》","link":"2020/09/04/算法笔记之《算法笔记》"},"plink":"https://yuyuoo.github.io/2020/11/13/利用NS3部署不同拓扑无线网络/","toc":[{"id":"一、部署一个星型无线网络（一个ap，不少于5个接入点）","title":"一、部署一个星型无线网络（一个AP，不少于5个接入点）","index":"1"},{"id":"二、部署多跳无线网络（不少于6个网络节点）","title":"二、部署多跳无线网络（不少于6个网络节点）","index":"2"},{"id":"三、利用ns3部署一个lte网络","title":"三、利用NS3部署一个LTE网络","index":"3"}],"copyright":{"license":"Attribution-NonCommercial-NoDerivatives 4.0 International","published":"November 13, 2020","updated":"November 26, 2020","author":"YuYuoo"}}